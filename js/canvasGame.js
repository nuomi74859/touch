/*! touch 26-08-2014 */
!function(bodyStyle,$){return $.fn.canvasGame=function(options){"use strict";var self=this,opt=$.extend({target:"canvas",img:"",percent:.5,loadTarget:"#ajax-load",loadLocation:"/mobileLoad.html"},options),img=new Image,canvas=document.querySelector(opt.target),$canvas=self;canvas.style.backgroundColor="transparent",canvas.style.position="relative",img.addEventListener("load",function(){function layer(ctx){ctx.fillStyle="gray",ctx.fillRect(0,0,w,h)}function eventDown(e){e.preventDefault(),mousedown=!0}function eventCallback(){for(var data=ctx.getImageData(0,0,w,h).data,i=0,j=0;i<data.length;i+=4)data[i]&&data[i+1]&&data[i+2]&&data[i+3]&&j++;j<=w*h*opt.percent&&($canvas.off(),$(opt.loadTarget).empty().load(opt.loadLocation))}function eventUp(e){e.preventDefault(),mousedown=!1,eventCallback()}function eventMove(e){if(e.preventDefault(),mousedown){e.changedTouches&&(e=e.changedTouches[e.changedTouches.length-1]);var x=(e.clientX+document.body.scrollLeft||e.pageX)-offsetX||0,y=(e.clientY+document.body.scrollTop||e.pageY)-offsetY||0;ctx.beginPath(),ctx.arc(x,y,20,0,2*Math.PI),ctx.fill()}eventCallback()}var ctx,w=$canvas.width(),h=$canvas.height(),mousedown=!1;canvas.width=w,canvas.height=h,canvas.style.backgroundImage="url("+img.src+")",ctx=canvas.getContext("2d"),ctx.fillStyle="transparent",layer(ctx);var offsetX=$canvas.offset().left,offsetY=$canvas.offset().top;ctx.globalCompositeOperation="destination-out",$canvas.on({touchstart:eventDown,touchend:eventUp,touchmove:eventMove,mousedown:eventDown,mouseup:eventUp,mousemove:eventMove})}),img.src=opt.img},self}(document.body.style,window.Zepto);